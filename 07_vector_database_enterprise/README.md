# ä¼ä¸šçº§å‘é‡æ•°æ®åº“ç®¡ç† ğŸ—„ï¸

> ä»å¼€å‘Demoåˆ°ç”Ÿäº§éƒ¨ç½²ï¼ŒæŒæ¡Milvusä¼ä¸šçº§åº”ç”¨çš„å®Œæ•´çŸ¥è¯†ä½“ç³»

## ğŸ“– ç« èŠ‚æ¦‚è¿°

æœ¬ç« èŠ‚æ˜¯RAGé¡¹ç›®çš„**ä¼ä¸šçº§è¿›é˜¶å†…å®¹**ï¼Œæ·±å…¥è®²è§£å‘é‡æ•°æ®åº“ï¼ˆç‰¹åˆ«æ˜¯Milvusï¼‰åœ¨ç”Ÿäº§ç¯å¢ƒä¸­çš„éƒ¨ç½²ã€ä¼˜åŒ–å’Œè¿ç»´ã€‚ç›¸æ¯”åŸºç¡€çš„FAISSä½¿ç”¨ï¼Œè¿™é‡Œä¼šæ¶‰åŠï¼š

- ğŸ—ï¸ Milvus åº•å±‚æ¶æ„åŸç†
- ğŸ”„ Segment ç”Ÿå‘½å‘¨æœŸç®¡ç†  
- âš™ï¸ Flush ä¸ Compaction æœºåˆ¶
- ğŸ¯ å¤šå‘é‡æ··åˆæ£€ç´¢
- ğŸ“Š ä¸‰å±‚å­˜å‚¨æ¶æ„è®¾è®¡
- ğŸ’¼ é¢è¯•æ ¸å¿ƒçŸ¥è¯†ç‚¹

## ğŸ¯ å­¦ä¹ ç›®æ ‡

å®Œæˆæœ¬ç« èŠ‚å­¦ä¹ åï¼Œä½ å°†èƒ½å¤Ÿï¼š

- âœ… ç†è§£ Milvus 7å±‚æ•°æ®ç»„ç»‡æ¶æ„
- âœ… æŒæ¡ Growing/Sealed Segment çš„è½¬æ¢æœºåˆ¶
- âœ… é…ç½®ä¼ä¸šçº§ Flush å’Œ Compaction ç­–ç•¥
- âœ… å®ç°å¤šå‘é‡æ··åˆæ£€ç´¢ç³»ç»Ÿ
- âœ… è®¾è®¡ä¸‰å±‚å­˜å‚¨æ¶æ„ï¼ˆçƒ­æ¸©å†·ï¼‰
- âœ… åº”å¯¹å‘é‡æ•°æ®åº“ç›¸å…³é¢è¯•

---

## ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦å­¦ä¹ ä¼ä¸šçº§å‘é‡æ•°æ®åº“ï¼Ÿ

### 1.1 FAISS vs Milvus

ä½ å¯èƒ½å·²ç»åœ¨ä¹‹å‰çš„ç« èŠ‚ä¸­ä½¿ç”¨è¿‡ FAISSï¼Œå®ƒå¾ˆç®€å•ï¼š

```python
import faiss
index = faiss.IndexFlatL2(1024)
index.add(vectors)
distances, indices = index.search(query, k=5)
```

**ä½†åœ¨ä¼ä¸šç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒFAISS ä¼šé‡åˆ°è¿™äº›é—®é¢˜**ï¼š

| æŒ‘æˆ˜ | FAISS | Milvus |
|------|-------|--------|
| **æ•°æ®è§„æ¨¡** | < 100ä¸‡ï¼ˆçº¯å†…å­˜ï¼‰ | > 1äº¿ï¼ˆå†…å­˜+ç£ç›˜ï¼‰ |
| **å¢é‡æ›´æ–°** | éœ€è¦é‡å»ºæ•´ä¸ªç´¢å¼• | è‡ªåŠ¨å¢é‡ç´¢å¼• |
| **å…ƒæ•°æ®è¿‡æ»¤** | ä¸æ”¯æŒ | åŸç”Ÿæ”¯æŒ |
| **åˆ†å¸ƒå¼** | éœ€è¦è‡ªå·±å®ç° | åŸç”Ÿåˆ†å¸ƒå¼æ¶æ„ |
| **é«˜å¯ç”¨** | éœ€è¦è‡ªå·±å°è£… | å†…ç½®é«˜å¯ç”¨æ–¹æ¡ˆ |
| **ç›‘æ§å‘Šè­¦** | éœ€è¦è‡ªå·±å¼€å‘ | å®Œå–„çš„ç›‘æ§ç³»ç»Ÿ |
| **æˆæœ¬ä¼˜åŒ–** | å…¨éƒ¨çƒ­å­˜å‚¨ | çƒ­æ¸©å†·ä¸‰å±‚æ¶æ„ |

### 1.2 ä»€ä¹ˆæ—¶å€™é€‰æ‹© Milvusï¼Ÿ

```
é€‰æ‹© FAISS çš„åœºæ™¯ï¼š
âœ… åŸå‹å¼€å‘ã€POC éªŒè¯
âœ… æ•°æ®é‡ < 100ä¸‡
âœ… å•æœºéƒ¨ç½²è¶³å¤Ÿ
âœ… åªéœ€è¦å‘é‡æ£€ç´¢

é€‰æ‹© Milvus çš„åœºæ™¯ï¼š
âœ… æ•°æ®é‡ > 100ä¸‡ï¼ŒæŒç»­å¢é•¿
âœ… éœ€è¦åˆ†å¸ƒå¼éƒ¨ç½²
âœ… éœ€è¦å…ƒæ•°æ®è¿‡æ»¤ï¼ˆå…¬å¸ã€è¡Œä¸šã€æ—¥æœŸç­‰ï¼‰
âœ… éœ€è¦å¤šå‘é‡æ··åˆæ£€ç´¢
âœ… ä¼ä¸šçº§åº”ç”¨ï¼Œéœ€è¦é«˜å¯ç”¨å’Œç›‘æ§
âœ… éœ€è¦æˆæœ¬ä¼˜åŒ–ï¼ˆä¸‰å±‚å­˜å‚¨ï¼‰
```

---

## äºŒã€æœ¬ç« èŠ‚å†…å®¹ç»“æ„

### 2.1 å­¦ä¹ è·¯çº¿å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬ä¸€éƒ¨åˆ†ï¼šæ ¸å¿ƒç†è®ºï¼ˆå¿…è¯»ï¼‰                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”œâ”€ milvus_architecture.md                  â”‚
â”‚  â”‚   â”œâ”€ 7å±‚æ•°æ®ç»„ç»‡æ¶æ„                      â”‚
â”‚  â”‚   â”œâ”€ Growing vs Sealed Segment           â”‚
â”‚  â”‚   â”œâ”€ Flush è§¦å‘æœºåˆ¶                       â”‚
â”‚  â”‚   â”œâ”€ Compaction åˆå¹¶ç­–ç•¥                  â”‚
â”‚  â”‚   â””â”€ ä¸‰å±‚å­˜å‚¨æ¶æ„                          â”‚
â”‚  â”‚                                            â”‚
â”‚  â””â”€ interview_guide.md                       â”‚
â”‚      â””â”€ é¢è¯•é«˜é¢‘é—®é¢˜ä¸æ ‡å‡†ç­”æ¡ˆ                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬äºŒéƒ¨åˆ†ï¼šå®æˆ˜ä»£ç ï¼ˆåŠ¨æ‰‹ç»ƒä¹ ï¼‰               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”œâ”€ milvus_basic_setup.ipynb                â”‚
â”‚  â”‚   â”œâ”€ Docker éƒ¨ç½² Milvus                   â”‚
â”‚  â”‚   â”œâ”€ Collection åˆ›å»ºä¸é…ç½®                â”‚
â”‚  â”‚   â”œâ”€ ç´¢å¼•ç±»å‹é€‰æ‹©ï¼ˆHNSW/IVF/PQï¼‰          â”‚
â”‚  â”‚   â””â”€ åŸºç¡€ CRUD æ“ä½œ                       â”‚
â”‚  â”‚                                            â”‚
â”‚  â”œâ”€ milvus_segment_management.ipynb         â”‚
â”‚  â”‚   â”œâ”€ Segment çŠ¶æ€ç›‘æ§                     â”‚
â”‚  â”‚   â”œâ”€ å‘¨æœŸæ€§ Flush å®ç°                    â”‚
â”‚  â”‚   â”œâ”€ Compaction è§¦å‘ä¸ç›‘æ§                â”‚
â”‚  â”‚   â””â”€ æ€§èƒ½æŒ‡æ ‡è§‚å¯Ÿ                          â”‚
â”‚  â”‚                                            â”‚
â”‚  â””â”€ milvus_news_system.ipynb                â”‚
â”‚      â”œâ”€ å¤šå‘é‡Schemaè®¾è®¡                      â”‚
â”‚      â”œâ”€ æ··åˆæ£€ç´¢å®ç°                          â”‚
â”‚      â”œâ”€ Cross-Encoderç²¾æ’                    â”‚
â”‚      â””â”€ å®Œæ•´æ–°é—»æ£€ç´¢ç³»ç»Ÿ                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬ä¸‰éƒ¨åˆ†ï¼šç”Ÿäº§é…ç½®ï¼ˆä¼ä¸šåº”ç”¨ï¼‰               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”œâ”€ milvus_production_config.yaml           â”‚
â”‚  â”‚   â””â”€ ä¼ä¸šçº§é…ç½®æ¨¡æ¿                        â”‚
â”‚  â”‚                                            â”‚
â”‚  â””â”€ vector_db_comparison.md                 â”‚
â”‚      â””â”€ FAISS vs Milvus vs Qdrant å¯¹æ¯”      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒçŸ¥è¯†ç‚¹åœ°å›¾

```
Milvus æ•°æ®ç»„ç»‡ï¼ˆ7å±‚æ¶æ„ï¼‰
â”œâ”€ Vectorï¼ˆå‘é‡ï¼‰
â”œâ”€ Batchï¼ˆæ‰¹å¤„ç†ï¼‰
â”œâ”€ Growing Segmentï¼ˆå¢é•¿æ®µï¼‰
â”‚   â”œâ”€ æ— ç´¢å¼•ï¼Œçº¿æ€§æ‰«æ
â”‚   â”œâ”€ å®æ—¶å†™å…¥
â”‚   â””â”€ æ¯ä¸ª Collection æœ€å¤š 1 ä¸ª
â”œâ”€ Sealed Segmentï¼ˆå°é—­æ®µï¼‰
â”‚   â”œâ”€ åªè¯»ï¼Œæœ‰ç´¢å¼•
â”‚   â”œâ”€ æŸ¥è¯¢é«˜æ•ˆ
â”‚   â””â”€ å¯ä»¥æœ‰å¤šä¸ª
â”œâ”€ Compactionï¼ˆåˆå¹¶ï¼‰
â”œâ”€ Partitionï¼ˆåˆ†åŒºï¼‰
â””â”€ Collectionï¼ˆé›†åˆï¼‰

Flush æœºåˆ¶ï¼ˆGrowing â†’ Sealedï¼‰
â”œâ”€ è§¦å‘æ¡ä»¶1ï¼šæ•°æ®é‡ â‰¥ 512MB
â”œâ”€ è§¦å‘æ¡ä»¶2ï¼šæ—¶é—´ â‰¥ 24å°æ—¶
â”œâ”€ è§¦å‘æ¡ä»¶3ï¼šæ‰‹åŠ¨ collection.flush()
â””â”€ æ¨èç­–ç•¥ï¼šå‘¨æœŸæ€§æ‰‹åŠ¨ï¼ˆæ¯6å°æ—¶ï¼‰+ è‡ªåŠ¨å¤‡é€‰

Compaction æœºåˆ¶ï¼ˆSegment åˆå¹¶ï¼‰
â”œâ”€ è§¦å‘æ¡ä»¶1ï¼šSegment æ•° > 30
â”œâ”€ è§¦å‘æ¡ä»¶2ï¼šåˆ é™¤å æ¯” > 10%
â”œâ”€ è§¦å‘æ¡ä»¶3ï¼šå®šæ—¶æ£€æŸ¥ï¼ˆæ¯12-24å°æ—¶ï¼‰
â”œâ”€ è§¦å‘æ¡ä»¶4ï¼šæ‰‹åŠ¨ collection.compact()
â””â”€ æ•ˆæœï¼šæŸ¥è¯¢é€Ÿåº¦æå‡ 30-50%

ä¸‰å±‚å­˜å‚¨æ¶æ„
â”œâ”€ çƒ­å±‚ï¼ˆ0-7å¤©ï¼‰ï¼šHNSW ç´¢å¼•ï¼Œ<100ms
â”œâ”€ æ¸©å±‚ï¼ˆ8-30å¤©ï¼‰ï¼šIVF ç´¢å¼•ï¼Œ100-500ms
â””â”€ å†·å±‚ï¼ˆ31+å¤©ï¼‰ï¼šIVF_PQ å‹ç¼©ï¼Œ1-5ç§’

å¤šå‘é‡æ··åˆæ£€ç´¢
â”œâ”€ Schemaè®¾è®¡ï¼šå…¨æ–‡ + æ‘˜è¦ + æ ‡é¢˜ å‘é‡
â”œâ”€ WeightedRankerï¼šæƒé‡èåˆï¼ˆ0.5, 0.3, 0.2ï¼‰
â”œâ”€ Cross-Encoder ç²¾æ’ï¼šç²¾åº¦æå‡ 15-25%
â””â”€ ä¸‰é˜¶æ®µæµç¨‹ï¼šå…ƒæ•°æ®è¿‡æ»¤ â†’ æ··åˆæ£€ç´¢ â†’ ç²¾æ’
```

---

## ä¸‰ã€å¿«é€Ÿå¼€å§‹

### 3.1 ç¯å¢ƒå‡†å¤‡

**ç¡¬ä»¶è¦æ±‚**ï¼š
```
æœ€ä½é…ç½®ï¼š
â”œâ”€ CPUï¼š8æ ¸+
â”œâ”€ å†…å­˜ï¼š16GB+
â”œâ”€ å­˜å‚¨ï¼š100GB SSD
â””â”€ é€‚åˆï¼šå­¦ä¹ å’Œå°è§„æ¨¡æµ‹è¯•

æ¨èé…ç½®ï¼š
â”œâ”€ CPUï¼š16æ ¸+
â”œâ”€ å†…å­˜ï¼š64GB+
â”œâ”€ GPUï¼šT4 æˆ–æ›´å¥½ï¼ˆå¯é€‰ï¼ŒåŠ é€Ÿå‘é‡åŒ–ï¼‰
â”œâ”€ å­˜å‚¨ï¼š500GB+ SSD
â””â”€ é€‚åˆï¼šä¼ä¸šç”Ÿäº§ç¯å¢ƒ
```

**è½¯ä»¶ä¾èµ–**ï¼š
```bash
# Dockerï¼ˆæ¨èï¼‰
docker --version  # >= 20.10

# Python ç¯å¢ƒ
python --version  # >= 3.8

# å¿…è¦çš„ Python åº“
pip install pymilvus sentence-transformers numpy pandas
```

### 3.2 ç¬¬ä¸€ä¸ª Milvus åº”ç”¨

```python
from pymilvus import connections, Collection, FieldSchema, CollectionSchema, DataType

# 1. è¿æ¥ Milvus
connections.connect(host='localhost', port='19530')

# 2. å®šä¹‰ Schema
fields = [
    FieldSchema(name="id", dtype=DataType.INT64, is_primary=True, auto_id=True),
    FieldSchema(name="text", dtype=DataType.VARCHAR, max_length=5000),
    FieldSchema(name="embedding", dtype=DataType.FLOAT_VECTOR, dim=1024)
]
schema = CollectionSchema(fields, description="æ–°é—»å‘é‡åº“")

# 3. åˆ›å»º Collection
collection = Collection(name="news", schema=schema)

# 4. åˆ›å»ºç´¢å¼•
index_params = {
    "metric_type": "IP",
    "index_type": "HNSW",
    "params": {"M": 16, "efConstruction": 200}
}
collection.create_index(field_name="embedding", index_params=index_params)

# 5. æ’å…¥æ•°æ®
from sentence_transformers import SentenceTransformer
model = SentenceTransformer('BAAI/bge-large-zh-v1.5')

texts = ["æ–°é—»1", "æ–°é—»2", "æ–°é—»3"]
embeddings = model.encode(texts).tolist()

entities = [
    {"text": t, "embedding": e} 
    for t, e in zip(texts, embeddings)
]
collection.insert(entities)

# 6. åŠ è½½åˆ°å†…å­˜
collection.load()

# 7. æœç´¢
query_text = "ä»Šå¤©çš„æ–°é—»"
query_vec = model.encode([query_text]).tolist()

results = collection.search(
    data=query_vec,
    anns_field="embedding",
    param={"metric_type": "IP", "params": {"ef": 64}},
    limit=5,
    output_fields=["text"]
)

for hits in results:
    for hit in hits:
        print(f"ç›¸ä¼¼åº¦: {hit.score:.4f}, æ–‡æœ¬: {hit.entity.get('text')}")
```

**è¾“å‡º**ï¼š
```
ç›¸ä¼¼åº¦: 0.8523, æ–‡æœ¬: æ–°é—»2
ç›¸ä¼¼åº¦: 0.7234, æ–‡æœ¬: æ–°é—»1
ç›¸ä¼¼åº¦: 0.6891, æ–‡æœ¬: æ–°é—»3
```

---

## å››ã€ç« èŠ‚è¯¦ç»†å†…å®¹

### 4.1 Milvus æ¶æ„æ·±åº¦è§£æ

ğŸ“˜ **æ–‡æ¡£**ï¼š[milvus_architecture.md](./milvus_architecture.md)

**æ ¸å¿ƒå†…å®¹**ï¼š
- Milvus 7å±‚æ•°æ®ç»„ç»‡ä½“ç³»
- Growing vs Sealed Segment è¯¦è§£
- Flush çš„ä¸‰ç§è§¦å‘æœºåˆ¶
- Compaction çš„å››ç§è§¦å‘æ¡ä»¶
- å®Œæ•´æ•°æ®ç”Ÿå‘½å‘¨æœŸ
- ä¼ä¸šçº§æœ€ä½³å®è·µé…ç½®

**é€‚åˆäººç¾¤**ï¼š
- å‡†å¤‡é¢è¯•çš„å¼€å‘è€…
- éœ€è¦æ·±å…¥ç†è§£åº•å±‚åŸç†çš„å·¥ç¨‹å¸ˆ
- æ¶æ„è®¾è®¡äººå‘˜

**é˜…è¯»æ—¶é—´**ï¼š30-45 åˆ†é’Ÿ

---

### 4.2 é¢è¯•ç­”é¢˜æ¨¡æ¿

ğŸ“˜ **æ–‡æ¡£**ï¼š[interview_guide.md](./interview_guide.md)

**æ ¸å¿ƒå†…å®¹**ï¼š
- 10+ é«˜é¢‘é¢è¯•é—®é¢˜
- æ ‡å‡†ç­”é¢˜æ¡†æ¶
- æŠ€æœ¯å¯¹æ¯”åˆ†æ
- å®æˆ˜åœºæ™¯è®¾è®¡
- é¢è¯•ä¸´åœºæŠ€å·§

**å…¸å‹é—®é¢˜**ï¼š
```
Q1: Milvus ä¸­ Segmentã€Growingã€Sealedã€Compactionã€Flush çš„å…³ç³»ï¼Ÿ
Q2: å¤šå°‘ä¸ª Document å˜æˆä¸€ä¸ª Segmentï¼Ÿ
Q3: Flush å’Œ Compaction çš„æ€§èƒ½å½±å“ï¼Ÿ
Q4: å¦‚ä½•è®¾è®¡ä¼ä¸šæ–°é—»å‘é‡æ£€ç´¢ç³»ç»Ÿï¼Ÿ
Q5: å¦‚ä½•åšå¢é‡ç´¢å¼•ï¼Ÿ
Q6: å‘é‡æ£€ç´¢å»¶è¿Ÿé«˜æ€ä¹ˆä¼˜åŒ–ï¼Ÿ
Q7: å¦‚ä½•é€‰æ‹©åˆé€‚çš„ç´¢å¼•ç±»å‹ï¼Ÿ
Q8: ç”Ÿäº§ç¯å¢ƒéƒ¨ç½² Milvus éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ
Q9: Milvus vs FAISS vs Qdrantï¼Œå¦‚ä½•é€‰æ‹©ï¼Ÿ
Q10: è®¾è®¡ä¸€ä¸ªæ—¥æ–°å¢100ä¸‡æ¡çš„æ–°é—»æ£€ç´¢ç³»ç»Ÿ
```

**é˜…è¯»æ—¶é—´**ï¼š60-90 åˆ†é’Ÿ

---

### 4.3 Milvus åŸºç¡€éƒ¨ç½²ï¼ˆNotebookï¼‰

ğŸ““ **ä»£ç **ï¼š[milvus_basic_setup.ipynb](./milvus_basic_setup.ipynb)

**å®æˆ˜å†…å®¹**ï¼š
1. Docker éƒ¨ç½² Milvusï¼ˆå•æœºç‰ˆ + é›†ç¾¤ç‰ˆï¼‰
2. Collection åˆ›å»ºä¸é…ç½®
3. ç´¢å¼•ç±»å‹é€‰æ‹©ï¼šHNSW / IVF / IVF_PQ
4. åŸºç¡€ CRUD æ“ä½œ
5. æŸ¥è¯¢å‚æ•°è°ƒä¼˜

**å­¦ä¹ æ—¶é—´**ï¼š2-3 å°æ—¶

---

### 4.4 Segment ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆNotebookï¼‰

ğŸ““ **ä»£ç **ï¼š[milvus_segment_management.ipynb](./milvus_segment_management.ipynb)

**å®æˆ˜å†…å®¹**ï¼š
1. Segment çŠ¶æ€ç›‘æ§ï¼ˆAPI è°ƒç”¨ï¼‰
2. å‘¨æœŸæ€§ Flush å®ç°ï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰
3. Compaction è§¦å‘ä¸ç›‘æ§
4. æ€§èƒ½æŒ‡æ ‡è§‚å¯Ÿï¼ˆå»¶è¿Ÿã€ååé‡ï¼‰
5. å‘Šè­¦è§„åˆ™è®¾ç½®

**æ ¸å¿ƒä»£ç ç¤ºä¾‹**ï¼š
```python
import schedule
import time

# å‘¨æœŸæ€§ Flush
def periodic_flush():
    collection.flush()
    print(f"[{time.strftime('%Y-%m-%d %H:%M:%S')}] Flush å®Œæˆ")
    
    # æ£€æŸ¥ Segment çŠ¶æ€
    stats = collection.get_stats()
    print(f"Segment æ•°é‡: {stats['segment_count']}")

schedule.every(6).hours.do(periodic_flush)

while True:
    schedule.run_pending()
    time.sleep(60)
```

**å­¦ä¹ æ—¶é—´**ï¼š3-4 å°æ—¶

---

### 4.5 ä¼ä¸šæ–°é—»æ£€ç´¢ç³»ç»Ÿï¼ˆNotebookï¼‰

ğŸ““ **ä»£ç **ï¼š[milvus_news_system.ipynb](./milvus_news_system.ipynb)

**å®Œæ•´å®ç°**ï¼š
1. å¤šå‘é‡ Schema è®¾è®¡ï¼ˆå…¨æ–‡ + æ‘˜è¦ + æ ‡é¢˜ï¼‰
2. æ‰¹é‡æ•°æ®å¯¼å…¥ï¼ˆæ—¥æ–°å¢100ä¸‡æ¡ï¼‰
3. å…ƒæ•°æ®è¿‡æ»¤ï¼ˆå…¬å¸ã€è¡Œä¸šã€æ—¥æœŸï¼‰
4. æ··åˆæ£€ç´¢ï¼ˆWeightedRankerï¼‰
5. Cross-Encoder ç²¾æ’
6. ä¸‰å±‚å­˜å‚¨æ¶æ„å®ç°
7. æ€§èƒ½æµ‹è¯•ä¸ä¼˜åŒ–

**ç³»ç»Ÿæ¶æ„**ï¼š
```python
# Schema è®¾è®¡
fields = [
    FieldSchema(name="pk_id", dtype=DataType.VARCHAR, is_primary=True, max_length=100),
    FieldSchema(name="company_name", dtype=DataType.VARCHAR, max_length=200),
    FieldSchema(name="indus_name", dtype=DataType.VARCHAR, max_length=100),
    FieldSchema(name="announcement_date", dtype=DataType.VARCHAR, max_length=20),
    FieldSchema(name="text", dtype=DataType.VARCHAR, max_length=10000),
    
    # å¤šå‘é‡è®¾è®¡
    FieldSchema(name="dense_vector_full", dtype=DataType.FLOAT_VECTOR, dim=1024),
    FieldSchema(name="dense_vector_summary", dtype=DataType.FLOAT_VECTOR, dim=1024),
    FieldSchema(name="dense_vector_title", dtype=DataType.FLOAT_VECTOR, dim=512),
]

# æ··åˆæ£€ç´¢
from pymilvus import AnnSearchRequest, WeightedRanker

req_full = AnnSearchRequest(data=[query_vec_full], anns_field="dense_vector_full", param={"ef": 64}, limit=50)
req_summary = AnnSearchRequest(data=[query_vec_summary], anns_field="dense_vector_summary", param={"ef": 64}, limit=50)
req_title = AnnSearchRequest(data=[query_vec_title], anns_field="dense_vector_title", param={"ef": 64}, limit=50)

ranker = WeightedRanker(0.5, 0.3, 0.2)
results = collection.hybrid_search([req_full, req_summary, req_title], ranker=ranker, limit=10)
```

**å­¦ä¹ æ—¶é—´**ï¼š4-6 å°æ—¶

---

### 4.6 ç”Ÿäº§ç¯å¢ƒé…ç½®æ¨¡æ¿

âš™ï¸ **é…ç½®**ï¼š[milvus_production_config.yaml](./milvus_production_config.yaml)

**é…ç½®å†…å®¹**ï¼š
```yaml
# Flush ç›¸å…³é…ç½®
datanode:
  segment:
    max_size: 512          # Segment å¤§å°ä¸Šé™ï¼ˆMBï¼‰
    min_size: 128          # Compaction æœ€å°å¤„ç†å¤§å°ï¼ˆMBï¼‰

common:
  retentionDuration: 86400  # Growing Segment ä¿ç•™æ—¶é—´ï¼ˆç§’ï¼‰

# Compaction ç›¸å…³é…ç½®
dataCoord:
  enableAutoCompaction: true
  compactionRoundInterval: 43200  # 12å°æ—¶æ£€æŸ¥ä¸€æ¬¡
  
dataNode:
  binlog:
    garbage_collection_ratio: 0.15  # åˆ é™¤å æ¯”15%è§¦å‘

# ç´¢å¼•é…ç½®
index:
  defaultIndexType: HNSW
  defaultMetricType: IP
  
# æŸ¥è¯¢é…ç½®  
queryNode:
  cacheEnabled: true
  cacheSize: 2048  # MB

# èµ„æºé™åˆ¶
resources:
  dataNode:
    cpu: 8
    memory: 16Gi
  queryNode:
    cpu: 16
    memory: 64Gi
```

---

### 4.7 å‘é‡æ•°æ®åº“å¯¹æ¯”åˆ†æ

ğŸ“Š **æ–‡æ¡£**ï¼š[vector_db_comparison.md](./vector_db_comparison.md)ï¼ˆå¾…åˆ›å»ºï¼‰

**å¯¹æ¯”ç»´åº¦**ï¼š
- FAISS vs Milvus vs Qdrant
- é€‚ç”¨è§„æ¨¡ä¸åœºæ™¯
- æ€§èƒ½å¯¹æ¯”ï¼ˆæŸ¥è¯¢å»¶è¿Ÿã€ååé‡ï¼‰
- æˆæœ¬å¯¹æ¯”ï¼ˆéƒ¨ç½²æˆæœ¬ã€è¿ç»´æˆæœ¬ï¼‰
- ç”Ÿæ€æˆç†Ÿåº¦

---

## äº”ã€å­¦ä¹ è·¯çº¿å»ºè®®

### è·¯çº¿1ï¼šå¿«é€Ÿä¸Šæ‰‹ï¼ˆ2-3å°æ—¶ï¼‰

```
1. é˜…è¯» READMEï¼ˆæœ¬æ–‡ï¼‰
2. è¿è¡Œ milvus_basic_setup.ipynb
3. ç†è§£åŸºç¡€æ¦‚å¿µå’Œæ“ä½œ
```

### è·¯çº¿2ï¼šæ·±å…¥ç†è§£ï¼ˆ1-2å¤©ï¼‰

```
Day 1:
â”œâ”€ ä¸Šåˆï¼šé˜…è¯» milvus_architecture.md
â”œâ”€ ä¸‹åˆï¼šè¿è¡Œ milvus_segment_management.ipynb
â””â”€ æ™šä¸Šï¼šæ€»ç»“ Flush å’Œ Compaction æœºåˆ¶

Day 2:
â”œâ”€ ä¸Šåˆï¼šè¿è¡Œ milvus_news_system.ipynb
â”œâ”€ ä¸‹åˆï¼šå®ç°å¤šå‘é‡æ··åˆæ£€ç´¢
â””â”€ æ™šä¸Šï¼šæ€§èƒ½æµ‹è¯•ä¸ä¼˜åŒ–
```

### è·¯çº¿3ï¼šä¼ä¸šåº”ç”¨ï¼ˆ3-5å¤©ï¼‰

```
Week 1:
â”œâ”€ Day 1-2ï¼šæ·±å…¥ç†è§£è·¯çº¿
â”œâ”€ Day 3ï¼šé˜…è¯» interview_guide.mdï¼Œå‡†å¤‡é¢è¯•
â”œâ”€ Day 4ï¼šåœ¨è‡ªå·±çš„æ•°æ®ä¸Šå®è·µ
â”œâ”€ Day 5ï¼šéƒ¨ç½²ç”Ÿäº§ç¯å¢ƒï¼Œé…ç½®ç›‘æ§å‘Šè­¦
â””â”€ æŒç»­ï¼šé˜…è¯» Milvus å®˜æ–¹æ–‡æ¡£ï¼Œè·Ÿè¿›æ–°ç‰¹æ€§
```

### è·¯çº¿4ï¼šé¢è¯•å‡†å¤‡ï¼ˆ1å‘¨ï¼‰

```
Day 1-2ï¼šå­¦ä¹  milvus_architecture.mdï¼Œç†è§£åŸç†
Day 3-4ï¼šåˆ· interview_guide.mdï¼ŒèƒŒè¯µæ ¸å¿ƒç­”æ¡ˆ
Day 5ï¼šè‡ªå·±å®ç°ä¸€éä¼ä¸šæ–°é—»æ£€ç´¢ç³»ç»Ÿ
Day 6ï¼šæ¨¡æ‹Ÿé¢è¯•ï¼Œç»ƒä¹ è¡¨è¾¾
Day 7ï¼šæ€»ç»“å¸¸è§é—®é¢˜ï¼Œå‡†å¤‡è¿½é—®
```

---

## å…­ã€å¸¸è§é—®é¢˜

### Q1: å­¦å®Œè¿™ä¸ªç« èŠ‚éœ€è¦ä»€ä¹ˆåŸºç¡€ï¼Ÿ

**A**: 
```
å¿…éœ€ï¼š
â”œâ”€ Python ç¼–ç¨‹åŸºç¡€
â”œâ”€ äº†è§£å‘é‡æ£€ç´¢åŸºæœ¬æ¦‚å¿µ
â””â”€ å®Œæˆ 02_data_retriever ç« èŠ‚å­¦ä¹ 

åŠ åˆ†é¡¹ï¼š
â”œâ”€ äº†è§£åˆ†å¸ƒå¼ç³»ç»Ÿæ¦‚å¿µ
â”œâ”€ æœ‰ Docker ä½¿ç”¨ç»éªŒ
â””â”€ äº†è§£æ•°æ®åº“åŸºç¡€çŸ¥è¯†
```

### Q2: Milvus å’Œ FAISS å¯ä»¥å…±å­˜å—ï¼Ÿ

**A**: 
```
å¯ä»¥ï¼æ¨èæ¸è¿›å¼è¿ç§»ï¼š

1. å°è§„æ¨¡ POCï¼šFAISS
2. ä¸­ç­‰è§„æ¨¡ï¼ˆ< 100ä¸‡ï¼‰ï¼šFAISS æˆ– Milvus
3. å¤§è§„æ¨¡ï¼ˆ> 100ä¸‡ï¼‰ï¼šMilvus
4. è¶…å¤§è§„æ¨¡ï¼ˆ> 1äº¿ï¼‰ï¼šMilvus é›†ç¾¤

è¿ç§»ç­–ç•¥ï¼š
â”œâ”€ é˜¶æ®µ1ï¼šFAISS å’Œ Milvus å¹¶è¡Œè¿è¡Œ
â”œâ”€ é˜¶æ®µ2ï¼šç°åº¦åˆ‡æ¢ï¼ˆ10% â†’ 50% â†’ 100%ï¼‰
â””â”€ é˜¶æ®µ3ï¼šå®Œå…¨åˆ‡æ¢åˆ° Milvus
```

### Q3: å­¦å®Œèƒ½è¾¾åˆ°ä»€ä¹ˆæ°´å¹³ï¼Ÿ

**A**: 
```
ç†è®ºå±‚é¢ï¼š
â”œâ”€ æ·±å…¥ç†è§£ Milvus åº•å±‚åŸç†
â”œâ”€ æŒæ¡ä¼ä¸šçº§é…ç½®å’Œä¼˜åŒ–
â””â”€ èƒ½å¤Ÿåº”å¯¹ 90% çš„å‘é‡æ•°æ®åº“é¢è¯•é—®é¢˜

å®æˆ˜å±‚é¢ï¼š
â”œâ”€ èƒ½å¤Ÿéƒ¨ç½²ç”Ÿäº§çº§ Milvus é›†ç¾¤
â”œâ”€ èƒ½å¤Ÿè®¾è®¡å¤šå‘é‡æ··åˆæ£€ç´¢ç³»ç»Ÿ
â”œâ”€ èƒ½å¤Ÿå¤„ç†æ—¥å¢ç™¾ä¸‡çº§æ•°æ®è§„æ¨¡
â””â”€ èƒ½å¤Ÿè¿›è¡Œæ€§èƒ½è°ƒä¼˜å’Œæ•…éšœæ’æŸ¥
```

### Q4: è¿™äº›çŸ¥è¯†åœ¨å®é™…å·¥ä½œä¸­æœ‰ç”¨å—ï¼Ÿ

**A**: 
```
éå¸¸æœ‰ç”¨ï¼é€‚ç”¨åœºæ™¯ï¼š

1. RAG ç³»ç»Ÿå¼€å‘
   â””â”€ ä¼ä¸šçŸ¥è¯†åº“ã€å®¢æœæœºå™¨äººã€æ–‡æ¡£æ£€ç´¢

2. æ¨èç³»ç»Ÿ
   â””â”€ å•†å“æ¨èã€å†…å®¹æ¨è

3. å›¾åƒ/è§†é¢‘æ£€ç´¢
   â””â”€ ä»¥å›¾æœå›¾ã€è§†é¢‘å»é‡

4. é£æ§ç³»ç»Ÿ
   â””â”€ æ¬ºè¯ˆæ£€æµ‹ã€å¼‚å¸¸è¯†åˆ«

5. ç”Ÿç‰©ä¿¡æ¯å­¦
   â””â”€ è›‹ç™½è´¨ç»“æ„æ£€ç´¢

å¸‚åœºéœ€æ±‚ï¼š
â”œâ”€ å¤§å‚ï¼ˆé˜¿é‡Œã€è…¾è®¯ã€å­—èŠ‚ï¼‰ï¼šå¿…å¤‡æŠ€èƒ½
â”œâ”€ AI åˆ›ä¸šå…¬å¸ï¼šæ ¸å¿ƒç«äº‰åŠ›
â””â”€ ä¼ ç»Ÿä¼ä¸šæ•°å­—åŒ–ï¼šæ–°å…´éœ€æ±‚
```

---

## ä¸ƒã€è¿›é˜¶å­¦ä¹ èµ„æº

### å®˜æ–¹èµ„æº
- [Milvus å®˜æ–¹æ–‡æ¡£](https://milvus.io/docs)
- [Milvus GitHub](https://github.com/milvus-io/milvus)
- [Milvus ç¤¾åŒºè®ºå›](https://discuss.milvus.io/)

### è¿›é˜¶ä¸“é¢˜
- [Milvus æºç è§£æ](https://milvus.io/docs/architecture_overview.md)
- [å‘é‡ç´¢å¼•ç®—æ³•è¯¦è§£](https://milvus.io/docs/index.md)
- [åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡](https://milvus.io/docs/four_layers.md)

### ç›¸å…³è®ºæ–‡
- [HNSW ç®—æ³•è®ºæ–‡](https://arxiv.org/abs/1603.09320)
- [IVF ç®—æ³•è®ºæ–‡](https://hal.inria.fr/inria-00514462v2)

---

## å…«ã€æ€»ç»“ä¸å±•æœ›

### æœ¬ç« èŠ‚ä»·å€¼

```
å¯¹å­¦ä¹ è€…ï¼š
â”œâ”€ æŒæ¡ä¼ä¸šçº§å‘é‡æ•°æ®åº“æŠ€èƒ½
â”œâ”€ æå‡ RAG ç³»ç»Ÿè®¾è®¡èƒ½åŠ›
â”œâ”€ å¢å¼ºé¢è¯•ç«äº‰åŠ›
â””â”€ æ‹“å±•èŒä¸šå‘å±•æ–¹å‘

å¯¹é¡¹ç›®ï¼š
â”œâ”€ ä» POC åˆ°ç”Ÿäº§çš„å®Œæ•´è·¯å¾„
â”œâ”€ æ€§èƒ½ä¼˜åŒ–çš„ç³»ç»Ÿæ–¹æ³•è®º
â”œâ”€ æˆæœ¬æ§åˆ¶çš„å®æˆ˜ç»éªŒ
â””â”€ æ•…éšœå¤„ç†çš„åº”å¯¹ç­–ç•¥
```

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

å®Œæˆæœ¬ç« èŠ‚åï¼Œå»ºè®®ï¼š

1. **å®è·µé¡¹ç›®**ï¼šåœ¨è‡ªå·±çš„æ•°æ®ä¸Šå®ç°ä¸€ä¸ªå®Œæ•´çš„æ£€ç´¢ç³»ç»Ÿ
2. **æ€§èƒ½ä¼˜åŒ–**ï¼šå¯¹æ¯”ä¸åŒé…ç½®å’Œç´¢å¼•ç±»å‹çš„æ•ˆæœ
3. **æ·±å…¥æºç **ï¼šé˜…è¯» Milvus æ ¸å¿ƒæ¨¡å—æºç 
4. **ç¤¾åŒºè´¡çŒ®**ï¼šå‚ä¸ Milvus ç¤¾åŒºè®¨è®ºå’Œè´¡çŒ®

### æŒç»­å­¦ä¹ 

å‘é‡æ•°æ®åº“æ˜¯ä¸€ä¸ªå¿«é€Ÿå‘å±•çš„é¢†åŸŸï¼š

```
å…³æ³¨åŠ¨æ€ï¼š
â”œâ”€ Milvus æ–°ç‰ˆæœ¬å‘å¸ƒ
â”œâ”€ æ–°çš„ç´¢å¼•ç®—æ³•ï¼ˆå¦‚ DiskANNï¼‰
â”œâ”€ å‘é‡å‹ç¼©æŠ€æœ¯ï¼ˆå¦‚ PQã€SQï¼‰
â””â”€ å¤šæ¨¡æ€æ£€ç´¢ï¼ˆæ–‡æœ¬+å›¾åƒ+éŸ³é¢‘ï¼‰

æ‹“å±•æ–¹å‘ï¼š
â”œâ”€ å›¾æ£€ç´¢ï¼ˆGraphRAGï¼‰
â”œâ”€ å¤šæ¨¡æ€ Embedding
â”œâ”€ è”é‚¦å­¦ä¹  + å‘é‡æ£€ç´¢
â””â”€ å‘é‡æ•°æ®åº“ + åŒºå—é“¾
```

---

## ä¸‹ä¸€æ­¥

å®Œæˆä¼ä¸šçº§å‘é‡æ•°æ®åº“å­¦ä¹ åï¼Œç»§ç»­ï¼š

â¡ï¸ [è¿”å›é¡¹ç›®ä¸»é¡µ](../README.md)  
â¡ï¸ [GraphRAG å›¾æ£€ç´¢](../03_graph_rag/README.md)  
â¡ï¸ [RAG è¯„ä¼°æ–¹æ³•](../05_rag_evaluation/README.md)

---

ğŸ’¡ **æœ€åçš„è¯**ï¼šä¼ä¸šçº§åº”ç”¨å’Œç©å…·Demoçš„æœ€å¤§åŒºåˆ«ï¼Œåœ¨äº**å¯¹ç»†èŠ‚çš„æè‡´è¿½æ±‚**å’Œ**å¯¹ç”Ÿäº§ç¯å¢ƒçš„æ•¬ç•ä¹‹å¿ƒ**ã€‚å¸Œæœ›è¿™ä¸ªç« èŠ‚èƒ½å¸®åŠ©ä½ ä»"ä¼šç”¨"åˆ°"ç²¾é€š"ï¼Œä»"å¼€å‘"åˆ°"æ¶æ„"ï¼

**Happy Learning! ğŸš€**

